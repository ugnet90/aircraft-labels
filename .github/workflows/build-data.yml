name: Build data

on:
  push:
    paths:
      - "models_export.csv"
      - "data/passenger_aircraft_full.csv"
      - "data/airline_logos.csv"
      - "data/liveries.csv"
      - "data/flights_export.csv"
      - "tools/build_json.py"
      - "tools/build_stats.py"
  workflow_dispatch:

concurrency:
  group: build-data-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Build model JSON
        run: python tools/build_json.py

      - name: Build stats (missing types + matrix)
        run: python tools/build_stats.py

      - name: Commit generated data
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add docs/index.json docs/data
          git commit -m "Build stats & data" || echo "No changes"
          git push
